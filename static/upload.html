<!doctype html>
<html lang="en">

<head>
    <title>upload</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <input type="file" name="file" onChange="handleFileUpload(event)" ref='upload' multiple/>
</body>
<script>
    function handleFileUpload(event) {
        const files = event.target.files
        for(let i=0;i<files.length;i++){
            const file = files[i]
            const formData = new FormData()
            formData.append('file', file)
            upload(formData)
        }     
        event.target.value = '' //貌似这样才会清空，才可以再次选择
    }

    function upload(formData) {
        
        return new Promise(resolve => {
            const _url = 'http://47.75.9.249/upload'
            const xhr = new XMLHttpRequest()
            xhr.open('post', _url)
            xhr.withCredentials = true
            xhr.onreadystatechange = function(){
                if(xhr.status == 200){
                    if(xhr.readyState == 4){
                        console.log('success upload')
                        resolve(JSON.parse(xhr.responseText))
                    }
                }else{
                    console.log('success failed')
                }
            }
            xhr.send(formData)
        })

    }
</script>
</html>